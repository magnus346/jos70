<!DOCTYPE html>
<html>
<head>
  <title>Socket Broadcaster</title>
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
  <script src="/socket.io/socket.io.js"></script>
  <style>body { width:100%; height:100vh; }</style>
</head>
<body>
  <audio id="right" src="audio-right.mp3" preload="auto"></audio>
  <audio id="wrong" src="audio-wrong.mp3" preload="auto"></audio>
  <script>
    const socket = io();

    let timer = null;

    const playAudio = (color, audio) => {
      audio.pause();
      audio.currentTime = 0;
      audio.play();
      document.body.style.background = color;
      if(timer !== null)
        clearTimeout(timer);
      timer = setTimeout(() => { document.body.style.background = "black"; }, 1500);
    }

    const playRight = () => {
      if(!taped) return false;
      playAudio('green', document.getElementById("right"));
    };

    const playWrong = () => {
      if(!taped) return false;
      playAudio('red', document.getElementById("wrong"));
    };

    let taped = false;
    document.addEventListener('click', () => {
      taped = true;
      document.body.style.background = "black";
    });
    
    socket.on('message', msg => {
      if(msg === 'right')
        playRight();
      if(msg === 'wrong')
        playWrong();
    });
  </script>
</body>
</html>
